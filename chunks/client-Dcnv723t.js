class n extends Error{code;statusCode;isOperational;constructor(e,s="INTERNAL_ERROR",r=500,o=!0){super(e),this.code=s,this.statusCode=r,this.isOperational=o,Error.captureStackTrace(this,this.constructor)}}class h extends n{constructor(e,s){super(e,"VALIDATION_ERROR",400),this.name="ValidationError"}}class d extends n{constructor(){super("Rate limit exceeded","RATE_LIMIT",429),this.name="RateLimitError"}}const m={baseURL:"https://localhost:3000",timeout:1e4,retries:3,retryDelay:1e3},l=new Map;class f{baseURL;timeout;constructor(e=m){this.baseURL=e.baseURL,this.timeout=e.timeout}async request(e,s={}){const{retries:r=m.retries,...o}=s,c=`${this.baseURL}/api${e}`,a=new AbortController,u=setTimeout(()=>a.abort(),this.timeout);try{const i=await fetch(c,{...o,signal:a.signal,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",...o.headers}});if(clearTimeout(u),!i.ok)throw new n(`API request failed: ${i.statusText}`,"API_ERROR",i.status);return await i.json()}catch(i){if(clearTimeout(u),r>0&&this.isRetryableError(i))return await this.delay(m.retryDelay),this.request(e,{...s,retries:r-1});throw this.handleError(i)}}checkRateLimit(e,s=10,r=6e4){const o=Date.now(),c=`${e}:${Math.floor(o/r)}`,a=l.get(c)||{count:0,resetTime:o+r};if(a.count>=s)throw new d;a.count++,l.set(c,a);for(const[u,i]of l.entries())i.resetTime<o&&l.delete(u)}async submitBookingForm(e){this.checkRateLimit(e.phone,3,3e5),this.validateBookingData(e);const s=this.sanitizeBookingData(e);return this.request("/forms/booking",{method:"POST",body:JSON.stringify({...s,recaptchaToken:e.recaptchaToken,timestamp:new Date().toISOString(),requestId:this.generateRequestId()})})}async submitContactForm(e){this.checkRateLimit(e.email,5,6e5),this.validateContactData(e);const s=this.sanitizeContactData(e);return this.request("/forms/contact",{method:"POST",body:JSON.stringify({...s,recaptchaToken:e.recaptchaToken,timestamp:new Date().toISOString(),requestId:this.generateRequestId()})})}async subscribeNewsletter(e){if(this.checkRateLimit(e,2,864e5),!this.isValidEmail(e))throw new h("Invalid email address");return this.request("/forms/newsletter",{method:"POST",body:JSON.stringify({email:e.toLowerCase().trim(),source:"website",timestamp:new Date().toISOString()})})}async trackEvent(e,s={}){try{await this.request("/analytics/track",{method:"POST",body:JSON.stringify({event:e,properties:{...s,url:window.location.href,userAgent:navigator.userAgent,timestamp:new Date().toISOString()}})})}catch(r){console.warn("Analytics tracking failed:",r)}}validateBookingData(e){const s=[];if((!e.name||e.name.trim().length<2)&&s.push("Name must be at least 2 characters"),(!e.phone||!this.isValidPhone(e.phone))&&s.push("Valid phone number is required"),(!e.address||e.address.trim().length<5)&&s.push("Complete address is required"),e.serviceType||s.push("Service type is required"),e.urgency||s.push("Urgency level is required"),e.email&&!this.isValidEmail(e.email)&&s.push("Invalid email format"),s.length>0)throw new h(s.join(", "))}validateContactData(e){const s=[];if((!e.name||e.name.trim().length<2)&&s.push("Name must be at least 2 characters"),(!e.email||!this.isValidEmail(e.email))&&s.push("Valid email is required"),(!e.subject||e.subject.trim().length<5)&&s.push("Subject must be at least 5 characters"),(!e.message||e.message.trim().length<10)&&s.push("Message must be at least 10 characters"),e.phone&&!this.isValidPhone(e.phone)&&s.push("Invalid phone format"),s.length>0)throw new h(s.join(", "))}sanitizeBookingData(e){return{...e,name:this.sanitizeString(e.name),phone:this.sanitizePhone(e.phone),email:e.email?this.sanitizeEmail(e.email):void 0,address:this.sanitizeString(e.address),serviceType:this.sanitizeString(e.serviceType),notes:e.notes?this.sanitizeString(e.notes):void 0}}sanitizeContactData(e){return{...e,name:this.sanitizeString(e.name),email:this.sanitizeEmail(e.email),phone:e.phone?this.sanitizePhone(e.phone):void 0,subject:this.sanitizeString(e.subject),message:this.sanitizeString(e.message)}}sanitizeString(e){return e.trim().replace(/[<>'"]/g,"").substring(0,1e3)}sanitizePhone(e){return e.replace(/[^\d+()-.\s]/g,"").substring(0,20)}sanitizeEmail(e){return e.toLowerCase().trim().substring(0,254)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)&&e.length<=254}isValidPhone(e){return/^[\+]?[1-9][\d\s\-\(\)\.]{7,15}$/.test(e.replace(/\s/g,""))}isRetryableError(e){return e instanceof n?e.statusCode>=500||e.statusCode===408||e.statusCode===429:e.name==="TypeError"||e.name==="NetworkError"}handleError(e){return e instanceof n?e:e.name==="AbortError"?new n("Request timeout","TIMEOUT",408):e.name==="TypeError"?new n("Network error","NETWORK_ERROR",0):new n("Unknown error occurred","UNKNOWN_ERROR",500)}async delay(e){return new Promise(s=>setTimeout(s,e))}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const g=new f,R=t=>g.submitBookingForm(t),y=t=>g.submitContactForm(t),p=(t,e)=>g.trackEvent(t,e),w={name:t=>!t||t.trim().length<2?"Name must be at least 2 characters":t.length>100?"Name is too long":/^[a-zA-Z\s\-'\.]+$/.test(t)?null:"Name contains invalid characters",phone:t=>{if(!t)return"Phone number is required";const e=t.replace(/[\s\-\(\)\.]/g,"");return e.length<10?"Phone number is too short":e.length>15?"Phone number is too long":/^[\+]?[1-9]\d{7,14}$/.test(e)?null:"Invalid phone number format"},email:t=>t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?t.length>254?"Email address is too long":null:"Invalid email format":null,address:t=>!t||t.trim().length<5?"Complete address is required":t.length>200?"Address is too long":null,message:(t,e=10)=>!t||t.trim().length<e?`Message must be at least ${e} characters`:t.length>2e3?"Message is too long":null},E=t=>{if(t instanceof h)return t.message;if(t instanceof d)return"Too many requests. Please wait a few minutes before trying again.";if(t instanceof n)switch(t.code){case"TIMEOUT":return"Request timed out. Please check your connection and try again.";case"NETWORK_ERROR":return"Network error. Please check your connection and try again.";default:return"An error occurred. Please try again or call us directly."}return"An unexpected error occurred. Please try again or call us directly."},S=t=>{p("form_submission_success",{form_type:t,timestamp:new Date().toISOString()}),typeof gtag<"u"&&gtag("event","conversion",{send_to:"AW-CONVERSION-ID/CONVERSION_LABEL",event_category:"Form",event_label:t,value:t==="booking"?1:.5}),typeof fbq<"u"&&fbq("track","Lead",{content_name:t,content_category:"Form Submission",value:t==="booking"?1:.5,currency:"USD"})};export{y as a,E as h,R as s,S as t,w as v};
