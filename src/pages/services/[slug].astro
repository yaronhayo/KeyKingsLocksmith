---
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import BookingForm from '../../components/forms/BookingForm.astro';
import Button from '../../components/ui/Button.astro';
import { companyConfig, getPhoneLink } from '../../data/company';
import SchemaMarkup from '../../components/seo/SchemaMarkup.astro';

export async function getStaticPaths() {
  const services = await getCollection('services');
  return services.map((service) => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

interface Props {
  service: CollectionEntry<'services'>;
}

const { service } = Astro.props;
const { Content } = await service.render();

const title = `${service.data.title} - ${companyConfig.name}`;
const description = service.data.description;

// Schema markup for service
const serviceSchema = {
  name: service.data.title,
  description: service.data.description,
  provider: {
    name: companyConfig.name,
    telephone: companyConfig.contact.phone.number,
  },
  areaServed: companyConfig.serviceAreas.primary,
  offers: service.data.pricing ? {
    priceRange: service.data.pricing,
  } : undefined,
};
---

<BaseLayout title={title} description={description}>
  <Header />

  <SchemaMarkup type="Service" data={serviceSchema} />

  <main>
    <!-- Service Hero -->
    <section class="bg-gradient-to-br from-primary-600 to-secondary-600 text-white py-16">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <!-- Service Icon -->
          {service.data.icon && (
            <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full mb-6">
              <span class="text-4xl">{service.data.icon}</span>
            </div>
          )}

          <h1 class="text-4xl md:text-5xl font-bold mb-4">
            {service.data.title}
          </h1>

          <p class="text-xl text-white/90 mb-8">
            {service.data.description}
          </p>

          <!-- Quick Actions -->
          <div class="flex flex-wrap justify-center gap-4">
            <a href={getPhoneLink()}>
              <Button variant="secondary" size="lg">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                </svg>
                Call Now: {companyConfig.contact.phone.display}
              </Button>
            </a>
            <a href="#booking-form">
              <Button variant="outline" size="lg" class="border-white text-white hover:bg-white hover:text-primary-600">
                Request Service
              </Button>
            </a>
          </div>

          <!-- Service Badges -->
          {(service.data.featured || service.data.emergency) && (
            <div class="flex flex-wrap justify-center gap-3 mt-6">
              {service.data.featured && (
                <span class="px-4 py-2 bg-white/20 rounded-full text-sm font-semibold backdrop-blur-sm">
                  ‚≠ê Popular Service
                </span>
              )}
              {service.data.emergency && (
                <span class="px-4 py-2 bg-red-500/90 rounded-full text-sm font-semibold backdrop-blur-sm">
                  üö® Emergency Available 24/7
                </span>
              )}
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Service Content -->
    <section class="py-16">
      <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-3 gap-12">
          <!-- Main Content -->
          <div class="lg:col-span-2">
            <div class="prose prose-lg max-w-none">
              <Content />
            </div>

            <!-- Service Features -->
            {service.data.features && service.data.features.length > 0 && (
              <div class="mt-12">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">What's Included</h2>
                <div class="grid md:grid-cols-2 gap-4">
                  {service.data.features.map((feature) => (
                    <div class="flex items-start gap-3 p-4 bg-gray-50 rounded-lg">
                      <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                      </svg>
                      <span class="text-gray-700">{feature}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <!-- Response Time -->
            {service.data.responseTime && (
              <div class="mt-8 p-6 bg-blue-50 border-l-4 border-blue-600 rounded-r-lg">
                <div class="flex items-center gap-3">
                  <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                  </svg>
                  <div>
                    <h3 class="font-bold text-gray-900">Fast Response Time</h3>
                    <p class="text-gray-700">{service.data.responseTime}</p>
                  </div>
                </div>
              </div>
            )}
          </div>

          <!-- Sidebar -->
          <div class="lg:col-span-1">
            <!-- Booking Form -->
            <div id="booking-form" class="sticky top-8">
              <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-4">Request This Service</h3>
                <BookingForm
                  showTitle={false}
                  preSelectedService={service.data.title}
                />
              </div>

              <!-- Pricing -->
              {service.data.pricing && (
                <div class="bg-gray-50 rounded-lg p-6 mb-6">
                  <h3 class="font-bold text-gray-900 mb-2">Pricing</h3>
                  <p class="text-3xl font-bold text-primary-600 mb-2">{service.data.pricing}</p>
                  <p class="text-sm text-gray-600">Final price may vary based on specifics</p>
                </div>
              )}

              <!-- Trust Signals -->
              <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="font-bold text-gray-900 mb-4">Why Choose Us</h3>
                <ul class="space-y-3 text-sm">
                  <li class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Licensed & Insured</span>
                  </li>
                  <li class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Mobile Service Available</span>
                  </li>
                  <li class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Upfront Pricing</span>
                  </li>
                  <li class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>Same-Day Service</span>
                  </li>
                  <li class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>4.9‚òÖ Rating (150+ Reviews)</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Related Services -->
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-gray-900 text-center mb-12">Other Services</h2>
        <div class="grid md:grid-cols-3 gap-6 max-w-5xl mx-auto">
          {(await getCollection('services'))
            .filter(s => s.slug !== service.slug)
            .slice(0, 3)
            .map((relatedService) => (
              <a
                href={`/services/${relatedService.slug}`}
                class="block bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow"
              >
                {relatedService.data.icon && (
                  <div class="text-4xl mb-3">{relatedService.data.icon}</div>
                )}
                <h3 class="text-xl font-bold text-gray-900 mb-2">
                  {relatedService.data.title}
                </h3>
                <p class="text-gray-600 text-sm mb-3">
                  {relatedService.data.description}
                </p>
                <span class="text-primary-600 font-semibold text-sm">
                  Learn More ‚Üí
                </span>
              </a>
            ))}
        </div>
      </div>
    </section>
  </main>

  <Footer />
</BaseLayout>
