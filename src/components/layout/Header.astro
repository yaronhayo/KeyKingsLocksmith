---
import { companyConfig, getPhoneLink, getFormattedPhone } from '../../data/company';
---

<header id="main-header" class="header-default bg-white border-b border-charcoal-100 sticky top-0 z-50 transition-all duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="flex items-center group">
          <img
            src="/images/brand/logo.png"
            alt="Key Kings Locksmith Logo"
            class="h-16 w-auto transition-transform duration-300 group-hover:scale-105"
            width="182"
            height="160"
            fetchpriority="high"
            decoding="async"
          />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center space-x-6" aria-label="Main navigation">
        <!-- Services Dropdown -->
        <div class="nav-dropdown relative">
          <button class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative flex items-center gap-1">
            Services
            <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="dropdown-menu absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-charcoal-200 opacity-0 invisible transition-all duration-200 z-50">
            <div class="py-1">
              <a href="/services" class="block px-4 py-2.5 text-sm text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 border-b border-charcoal-100">
                All Services
              </a>
              <a href="/services/residential-locksmith" class="block px-4 py-2.5 text-sm text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200">
                Residential Locksmith
              </a>
              <a href="/services/commercial-locksmith" class="block px-4 py-2.5 text-sm text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200">
                Commercial Locksmith
              </a>
              <a href="/services/automotive-locksmith" class="block px-4 py-2.5 text-sm text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200">
                Automotive Locksmith
              </a>
              <a href="/services/emergency-locksmith" class="block px-4 py-2.5 text-sm text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200">
                Emergency Locksmith
              </a>
            </div>
          </div>
        </div>

        <a href="/service-areas" class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative">
          Service Areas
        </a>
        <a href="/faq" class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative">
          FAQ
        </a>
        <a href="/reviews" class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative">
          Reviews
        </a>
        <a href="/about" class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative">
          About
        </a>
        <a href="/contact" class="nav-link text-charcoal-700 hover:text-gold-600 font-medium transition-colors duration-200 relative">
          Contact
        </a>
      </nav>

      <!-- CTA Buttons & Mobile Menu Toggle -->
      <div class="flex items-center gap-3">
        <!-- CTA Container - visible on all screens -->
        <div id="header-ctas" class="flex items-center gap-2">
          <!-- Call CTA -->
          <a
            href={getPhoneLink()}
            class="inline-flex items-center gap-2 bg-gold-600 text-white px-3 py-2 lg:px-5 lg:py-2.5 rounded-lg text-sm lg:text-base font-bold hover:bg-gold-700 hover:text-white transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5"
          >
            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span class="hidden sm:inline">Call {getFormattedPhone()}</span>
            <span class="sm:hidden">Call</span>
          </a>

          <!-- Book Service CTA -->
          <a
            href="/book-service"
            class="inline-flex items-center gap-2 border-2 border-gold-600 text-gold-700 px-3 py-2 lg:px-5 lg:py-2.5 rounded-lg text-sm lg:text-base font-bold hover:bg-gold-600 hover:text-white transition-all duration-200"
          >
            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span class="hidden sm:inline">Book Service</span>
            <span class="sm:hidden">Book</span>
          </a>
        </div>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="lg:hidden inline-flex items-center justify-center p-2 rounded-lg text-charcoal-700 hover:text-gold-600 hover:bg-charcoal-50 transition-colors duration-200"
          aria-label="Toggle mobile menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg class="menu-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg class="close-icon w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu lg:hidden hidden border-t border-charcoal-100">
      <nav class="py-4 space-y-2" aria-label="Mobile navigation">
        <!-- Services Accordion -->
        <div class="mobile-services-accordion">
          <button class="mobile-services-toggle w-full flex items-center justify-between px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
            <span>Services</span>
            <svg class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="mobile-services-content hidden pl-6">
            <a href="/services" class="mobile-nav-link block px-4 py-2 text-sm text-charcoal-600 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 rounded-lg">
              All Services
            </a>
            <a href="/services/residential-locksmith" class="mobile-nav-link block px-4 py-2 text-sm text-charcoal-600 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 rounded-lg">
              Residential Locksmith
            </a>
            <a href="/services/commercial-locksmith" class="mobile-nav-link block px-4 py-2 text-sm text-charcoal-600 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 rounded-lg">
              Commercial Locksmith
            </a>
            <a href="/services/automotive-locksmith" class="mobile-nav-link block px-4 py-2 text-sm text-charcoal-600 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 rounded-lg">
              Automotive Locksmith
            </a>
            <a href="/services/emergency-locksmith" class="mobile-nav-link block px-4 py-2 text-sm text-charcoal-600 hover:bg-gold-50 hover:text-gold-600 transition-colors duration-200 rounded-lg">
              Emergency Locksmith
            </a>
          </div>
        </div>

        <a href="/service-areas" class="mobile-nav-link block px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
          Service Areas
        </a>
        <a href="/faq" class="mobile-nav-link block px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
          FAQ
        </a>
        <a href="/reviews" class="mobile-nav-link block px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
          Reviews
        </a>
        <a href="/about" class="mobile-nav-link block px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
          About
        </a>
        <a href="/contact" class="mobile-nav-link block px-4 py-3 text-charcoal-700 hover:bg-gold-50 hover:text-gold-600 font-medium transition-colors duration-200 rounded-lg">
          Contact
        </a>

        <!-- Mobile CTAs Container - CTAs will be moved here when menu opens -->
        <div id="mobile-ctas-container" class="px-4 pt-4 space-y-3 hidden"></div>
      </nav>
    </div>
  </div>
</header>

<style>
  /* Desktop nav link underline effect */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--color-gold-400);
    transition: width 0.3s ease;
  }

  .nav-link:hover::after {
    width: 100%;
  }

  /* Desktop Dropdown Menu */
  .nav-dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-dropdown .dropdown-menu {
    transform: translateY(-10px);
  }

  .nav-dropdown:hover button svg {
    transform: rotate(180deg);
  }

  /* Sticky header transformation */
  .header-scrolled {
    @apply shadow-md py-2;
  }

  .header-scrolled .h-16 {
    height: 3rem;
  }

  /* Mobile menu animations */
  .mobile-menu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }

  .mobile-menu.open {
    max-height: 800px;
  }

  /* Mobile Services Accordion */
  .mobile-services-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }

  .mobile-services-content.open {
    max-height: 300px;
  }

  .mobile-services-toggle.active svg {
    transform: rotate(180deg);
  }

  /* Smooth transitions for all interactive elements */
  a, button {
    -webkit-tap-highlight-color: transparent;
  }
</style>

<script>
  // Mobile menu toggle with CTA movement
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = mobileMenuButton?.querySelector('.menu-icon');
  const closeIcon = mobileMenuButton?.querySelector('.close-icon');
  const headerCtasContainer = document.getElementById('header-ctas');
  const mobileCtasContainer = document.getElementById('mobile-ctas-container');

  // Function to move CTAs to mobile menu
  function moveCtasToMenu() {
    if (headerCtasContainer && mobileCtasContainer && window.innerWidth < 1024) {
      const ctas = headerCtasContainer.cloneNode(true) as HTMLElement;
      ctas.id = 'menu-ctas';
      ctas.className = 'flex flex-col gap-3 w-full';

      // Update button styles for mobile menu
      const buttons = ctas.querySelectorAll('a');
      buttons.forEach(button => {
        button.className = button.className
          .replace('inline-flex items-center gap-2', 'flex items-center justify-center gap-2 w-full')
          .replace('px-3 py-2 lg:px-5 lg:py-2.5', 'px-6 py-3')
          .replace('text-sm lg:text-base', 'text-base');

        // Show full text in menu
        const hiddenSpan = button.querySelector('.hidden.sm\\:inline');
        const visibleSpan = button.querySelector('.sm\\:hidden');
        if (hiddenSpan && visibleSpan) {
          hiddenSpan.classList.remove('hidden', 'sm:inline');
          visibleSpan.classList.add('hidden');
        }
      });

      mobileCtasContainer.innerHTML = '';
      mobileCtasContainer.appendChild(ctas);
      mobileCtasContainer.classList.remove('hidden');
      headerCtasContainer.style.display = 'none';
    }
  }

  // Function to move CTAs back to header
  function moveCtasToHeader() {
    if (headerCtasContainer && mobileCtasContainer) {
      headerCtasContainer.style.display = 'flex';
      mobileCtasContainer.classList.add('hidden');
      mobileCtasContainer.innerHTML = '';
    }
  }

  mobileMenuButton?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.contains('open');

    if (isOpen) {
      // Close menu
      mobileMenu?.classList.remove('open');
      mobileMenu?.classList.add('hidden');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');

      // Move CTAs back to header
      setTimeout(() => {
        moveCtasToHeader();
      }, 300); // Wait for menu close animation
    } else {
      // Open menu
      mobileMenu?.classList.remove('hidden');

      // Move CTAs to menu
      moveCtasToMenu();

      // Small delay to trigger animation
      setTimeout(() => {
        mobileMenu?.classList.add('open');
      }, 10);
      menuIcon?.classList.add('hidden');
      closeIcon?.classList.remove('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'true');
    }
  });

  // Close mobile menu when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (!target.closest('#mobile-menu') && !target.closest('#mobile-menu-button') && !target.closest('#header-ctas')) {
      if (mobileMenu?.classList.contains('open')) {
        mobileMenu?.classList.remove('open');
        mobileMenu?.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        mobileMenuButton?.setAttribute('aria-expanded', 'false');

        // Move CTAs back to header
        setTimeout(() => {
          moveCtasToHeader();
        }, 300);
      }
    }
  });

  // Close mobile menu when clicking on a link
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  mobileNavLinks.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.remove('open');
      mobileMenu?.classList.add('hidden');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
      mobileMenuButton?.setAttribute('aria-expanded', 'false');

      // Move CTAs back to header
      setTimeout(() => {
        moveCtasToHeader();
      }, 300);
    });
  });

  // Mobile Services Accordion
  const mobileServicesToggle = document.querySelector('.mobile-services-toggle');
  const mobileServicesContent = document.querySelector('.mobile-services-content');

  mobileServicesToggle?.addEventListener('click', () => {
    const isOpen = mobileServicesContent?.classList.contains('open');

    if (isOpen) {
      mobileServicesContent?.classList.remove('open');
      mobileServicesContent?.classList.add('hidden');
      mobileServicesToggle?.classList.remove('active');
    } else {
      mobileServicesContent?.classList.remove('hidden');
      setTimeout(() => {
        mobileServicesContent?.classList.add('open');
      }, 10);
      mobileServicesToggle?.classList.add('active');
    }
  });

  // Sticky header scroll behavior
  let lastScrollTop = 0;
  const header = document.getElementById('main-header');

  window.addEventListener('scroll', () => {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    if (scrollTop > 50) {
      header?.classList.add('header-scrolled');
    } else {
      header?.classList.remove('header-scrolled');
    }

    lastScrollTop = scrollTop;
  });
</script>
